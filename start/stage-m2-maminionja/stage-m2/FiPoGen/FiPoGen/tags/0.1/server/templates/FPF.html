{% extends "base.html" %}

{% block script %}
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script>
/* check if the FPF string is valid; change the image and button accordingly */
function checkFPF(id, img_name)
{
	if (isValidFPF(id.value))
	{
		$('#'+img_name).attr('src','accept.jpg');
		$(":submit").removeAttr("disabled");
	}
	else
	{
		$(":submit").attr("disabled", true);
		$('#'+img_name).attr('src','cross.jpg');
	}
}

/* check if a string is a valid FPF (Q notation or chevrons) */
function isValidFPF( fpf)
{
	if (fpf.length<4)
		return 0;
	var expQ = /^([su]?)Q([+-]?[0-9]+)\.([+-]?[0-9]+)$/;
	var expC = /^([su]?)<([+-]?[0-9]+),([+-]?[0-9]+)>$/;
	return expQ.test(fpf) ||Â expC.test(fpf);
}

/* called when the form is submitted; call the image */
function validate()
{
	var q = queryString();	// build the query
	var fpf = $('#format0').val();		// get the fpf
	/* load the image */
	$("#FPF_image").attr('src', '{{base_url}}spinner.gif');	/* first load the spinner */
	$("#FPF_image").attr('src', '{{base_url}}FPF/'+fpf+'.jpg?'+q);		/* and then load the image */
	/* change the different links */
	{% for img in imageFormats %}
	$("#a_{{img}}").attr( 'href', '{{base_url}}FPF/' + fpf +'.{{img}}?'+q);
	{% endfor %}
	/* get the latex code */
	$.get('{{base_url}}FPF/'+fpf + '.tex?' +q, function(data)
	{
		$('#str_latex').html(data);
	});
}

/* build the query from the different input elements of the form
(exactly like the serialize function of jQuery, BUT without taking into account the input named 'format') */
function queryString()
{
	var e=$("#f")[0].elements;
	var s = [];
	for(var i=0;i<e.length;i++)
	{
		if (e[i].name.substring(0,6)!="format")
		{
			if (e[i].name!="")
				if (e[i].type=="checkbox")
					s.push( e[i].name +"="+(e[i].checked?"yes":"no") )
				else
					s.push( e[i].name+"="+e[i].value );
		}
	}
	return s.join("&");
}
</script>
{% endblock %}

{% block content %}
Blablabla... This page allows to display a Fixed-Point Representation, and export it in LaTeX (Tikz), pdf of jpeg.

<p>

<div class="container">
	<div id="form">
	<form method="POST" action="javascript:validate();" id="f">
		<label for="format0">Fixed-Point Representation: </label><input id="format0" type="text" onkeyup="checkFPF(this,'FPF_valid0');"/><img id="FPF_valid0"/><br/>
		<label for="color">Color: </label>
		<select name="color">
			<option value="BW">Black&amp;White</option>
			<option value="YG" selected>Yellow&amp;Green</option>
		</select><br/>
		<input type="checkbox" name="binary_point" checked/> Show binary point <br/>
		<label for="label">Label: </label>
		<select name="FPF_label">
			<option value="None">None</option>
			<option value="left">Left</option>>
			<option value="right">Right</option>
			<option value="above">Above</option>
		</select><br/>
		<label for="notation">Notation: </label>
		<select name="notation">
			<option value="bag">alpha, beta, gamma</option>>
			<option value="w">MSB LSB weights</option>		
			<option value="numeric">Numeric</option>
		</select><br/>
		<input type="checkbox"  name="bag_label"/> Show beta, alpha, gamma <br/>
		<input type="checkbox" name="power2"> Show powers of 2<br/>
		<input type="submit" disabled/>
	</form>
	</div>
	
	<div id="result">
	<img id='FPF_image'><br/>
	<div>
	{% for img in imageFormats %}
		<a id='a_{{img}}' href=''>{{img}}</a>&nbsp;&nbsp;
	{% endfor %}
	<br/>
	<form action=""><textarea rows="4" cols='50' readonly=true id='str_latex'></textarea></form>
	</div>
</div>
{% endblock %}